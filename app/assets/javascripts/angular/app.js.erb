//= depend_on_asset "angular/main.html"

var app = angular.module("rcloudApp", ["ngRoute"]);


// Routes
app.config(function ($routeProvider) {

  $routeProvider
    .when("/", {
      controller: "MainCtrl",
      templateUrl: "<%= asset_path('angular/main.html') %>"
    })
    .otherwise({
      redirectTo: "/"
    })
})

app.controller("MainCtrl", function ($scope) {
  $scope.greeting = "Hello World!";
});

app.controller("SearchCtrl", function ($scope, $http) {
  $scope.searchQuery = "";
  

  $scope.search = function(query) {
    $scope.search.results = "";
    // Rdio Search
    // –––––––––––––––
    R.request({
      method: "search", 
      content: {
        query: query, 
        types: "Album", // changes to find artist, track, or album
        count: 10
      },
      success: function(response) {
        console.log("success");
        $scope.searchQuery = query;
        $scope.search.results = response.result.results;
        $scope.query = null;
        angular.element("form")[0].reset();
        angular.element("form")[0].blur();

        $scope.$apply();
      },
      error: function(response) {
        console.log("error");
        $(".error").text(response.message);
      }
    });
  };

  $scope.play = function(track) {
    console.log(track)
    R.player.play({source: track.key});
  }
});


app.controller("PlayerCtrl", function ($scope) {
  $scope.nowPlaying = {};

  $scope.togglePause = function() {
    R.player.togglePause()
  }
  $scope.previous = function() {
    R.player.previous()
  }
  $scope.next = function() {
    R.player.next()
  }

});






